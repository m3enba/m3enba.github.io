<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krestiki Noliki: Gobbler Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* Board Cell */
        .cell {
            background: rgba(30, 41, 59, 0.7); /* Slate 800 */
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cell.valid-target {
            background: rgba(51, 65, 85, 0.9);
            box-shadow: inset 0 0 0 2px rgba(94, 234, 212, 0.5); /* Highlight valid moves */
            cursor: pointer;
        }

        /* Inventory Items */
        .inventory-slot {
            transition: transform 0.2s, background-color 0.2s;
            cursor: pointer;
            border-radius: 0.5rem;
            padding: 0; /* Remove padding to maximize space for icon */
            background: rgba(255, 255, 255, 0.05);
            aspect-ratio: 1; /* Keep them square */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .inventory-slot:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.1);
        }

        .inventory-slot.selected {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 2px #fff;
            transform: scale(1.05);
            z-index: 10;
        }

        .inventory-slot.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        /* Pieces */
        .piece-x { color: #22d3ee; } /* Cyan 400 */
        .piece-o { color: #fb7185; } /* Rose 400 */

        /* INCREASED SIZES ON BOARD */
        .size-1 { width: 45%; height: 45%; stroke-width: 6px; }
        .size-2 { width: 75%; height: 75%; stroke-width: 5px; }
        .size-3 { width: 100%; height: 100%; stroke-width: 4px; } /* Fills the cell */

        .winning-cell {
            background-color: rgba(16, 185, 129, 0.2) !important;
            border: 2px solid #10b981;
        }

        /* Layout Utilities */
        .game-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            max-width: 100%;
            height: 100vh;
            padding: 1rem;
            grid-template-rows: auto auto 1fr auto;
        }

        @media (min-width: 768px) {
            .game-layout {
                grid-template-columns: 240px auto 240px; /* Widened sidebars */
                grid-template-rows: auto 1fr;
                align-items: center;
                justify-content: center;
            }
            .header-area { grid-column: 1 / -1; }
        }
    </style>
</head>
<body>

    <div class="game-layout">
        <!-- Header -->
        <div class="header-area text-center py-2">
            <h1 class="text-3xl md:text-5xl font-bold bg-gradient-to-r from-cyan-400 to-rose-400 bg-clip-text text-transparent">
                Gobblet Toe
            </h1>
            <div id="status-display" class="text-slate-400 text-sm md:text-lg font-medium h-8 mt-2">
                Blue's Turn (X)
            </div>
        </div>

        <!-- Player X Inventory (Left/Top) -->
        <div class="flex flex-row md:flex-col items-center justify-center gap-4 p-4 bg-slate-900/50 rounded-xl border border-slate-800 h-fit" id="inventory-x">
            <h3 class="hidden md:block text-cyan-400 font-bold mb-2">Player X</h3>
            <!-- Generated by JS -->
        </div>

        <!-- Game Board -->
        <div class="relative flex items-center justify-center">
            <div class="grid grid-cols-3 gap-3 p-3 bg-slate-800/50 rounded-2xl shadow-2xl border border-slate-700/50 w-[300px] h-[300px] md:w-[450px] md:h-[450px]">
                <!-- Cells 0-8 -->
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>
        </div>

        <!-- Player O Inventory (Right/Bottom) -->
        <div class="flex flex-row md:flex-col items-center justify-center gap-4 p-4 bg-slate-900/50 rounded-xl border border-slate-800 h-fit" id="inventory-o">
            <h3 class="hidden md:block text-rose-400 font-bold mb-2">Player O</h3>
            <!-- Generated by JS -->
        </div>

        <!-- Controls -->
        <div class="md:col-span-3 flex justify-center pb-4 md:pb-0">
            <button id="reset-btn" class="px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-full font-bold transition-colors shadow-lg flex items-center gap-2 text-sm md:text-base">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>
                Restart Game
            </button>
        </div>
    </div>

    <script>
        // Constants
        const PLAYERS = { X: 'X', O: 'O' };
        const SIZES = { SMALL: 1, MEDIUM: 2, LARGE: 3 };
        const WINNING_CONDITIONS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        // SVGs
        const SVG_X = (sizeClass) => `
            <svg class="${sizeClass} piece-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>`;
        
        const SVG_O = (sizeClass) => `
            <svg class="${sizeClass} piece-o" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
            </svg>`;

        // Game State
        let currentPlayer = PLAYERS.X;
        let gameActive = true;
        let boardState = Array(9).fill(null).map(() => []); // Array of stacks
        // Ensure sorted inventory for correct visual layout: Small, Small, Small, Med, Med, Med, Large, Large, Large
        let inventory = {
            [PLAYERS.X]: [SIZES.SMALL, SIZES.SMALL, SIZES.SMALL, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.LARGE, SIZES.LARGE, SIZES.LARGE],
            [PLAYERS.O]: [SIZES.SMALL, SIZES.SMALL, SIZES.SMALL, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.LARGE, SIZES.LARGE, SIZES.LARGE]
        };
        
        let selectedPiece = null; // { size: number, indexInInventory: number }

        // DOM Elements
        const statusDisplay = document.getElementById('status-display');
        const cells = document.querySelectorAll('.cell');
        const inventoryXEl = document.getElementById('inventory-x');
        const inventoryOEl = document.getElementById('inventory-o');
        const resetBtn = document.getElementById('reset-btn');

        // Init
        renderInventory();
        updateStatus();

        // --- Core Logic ---

        function updateStatus() {
            if (!gameActive) return;
            const pName = currentPlayer === PLAYERS.X ? "Blue (X)" : "Red (O)";
            const color = currentPlayer === PLAYERS.X ? "text-cyan-400" : "text-rose-400";
            statusDisplay.innerHTML = `<span class="${color}">${pName}</span> Select a piece`;
        }

        function getTopPiece(cellIndex) {
            const stack = boardState[cellIndex];
            if (stack.length === 0) return null;
            return stack[stack.length - 1];
        }

        function checkWin() {
            let roundWon = false;
            let winningSet = [];

            const currentBoard = boardState.map(stack => {
                if (stack.length === 0) return '';
                return stack[stack.length - 1].player;
            });

            for (let i = 0; i < WINNING_CONDITIONS.length; i++) {
                const [a, b, c] = WINNING_CONDITIONS[i];
                const valA = currentBoard[a];
                const valB = currentBoard[b];
                const valC = currentBoard[c];

                if (valA === '' || valB === '' || valC === '') continue;
                if (valA === valB && valB === valC) {
                    roundWon = true;
                    winningSet = WINNING_CONDITIONS[i];
                    break;
                }
            }

            if (roundWon) {
                gameActive = false;
                const winnerName = currentPlayer === PLAYERS.X ? "Blue" : "Red";
                const color = currentPlayer === PLAYERS.X ? "text-cyan-400" : "text-rose-400";
                statusDisplay.innerHTML = `<span class="${color} font-bold text-2xl">${winnerName} Wins!</span>`;
                highlightWinningCells(winningSet);
                disableInteractions();
            } else {
                // Switch turns
                currentPlayer = currentPlayer === PLAYERS.X ? PLAYERS.O : PLAYERS.X;
                selectedPiece = null;
                renderInventory(); 
                updateStatus();
            }
        }

        function highlightWinningCells(indices) {
            indices.forEach(i => cells[i].classList.add('winning-cell'));
        }

        function disableInteractions() {
            document.querySelectorAll('.inventory-slot').forEach(el => el.classList.remove('selected'));
            cells.forEach(c => c.classList.remove('valid-target'));
        }

        // --- Interaction Handlers ---

        function handleInventoryClick(player, size, index) {
            if (!gameActive) return;
            if (player !== currentPlayer) return; // Can't touch other's pieces

            // Toggle selection
            if (selectedPiece && selectedPiece.index === index && selectedPiece.player === player) {
                selectedPiece = null; // Deselect
            } else {
                selectedPiece = { player, size, index };
            }
            
            renderInventory(); // Update visuals (highlights)
            highlightValidMoves();
        }

        function highlightValidMoves() {
            cells.forEach(cell => cell.classList.remove('valid-target'));
            
            if (!selectedPiece) return;

            cells.forEach((cell, idx) => {
                const topPiece = getTopPiece(idx);
                // Valid if empty OR top piece is smaller than selected piece
                if (!topPiece || topPiece.size < selectedPiece.size) {
                    cell.classList.add('valid-target');
                }
            });
        }

        function handleCellClick(cellIndex) {
            if (!gameActive || !selectedPiece) return;

            const topPiece = getTopPiece(cellIndex);
            
            // Check Move Validity
            if (!topPiece || topPiece.size < selectedPiece.size) {
                // Execute Move
                
                // 1. Remove from inventory
                inventory[currentPlayer].splice(selectedPiece.index, 1);
                
                // 2. Add to board stack
                boardState[cellIndex].push({
                    player: currentPlayer,
                    size: selectedPiece.size
                });

                // 3. Update Visuals
                renderBoard();
                renderInventory();

                // 4. Check Win
                setTimeout(() => {
                    checkWin();
                }, 10);
                
            } else {
                const cell = cells[cellIndex];
                cell.style.transform = 'translateX(5px)';
                setTimeout(() => cell.style.transform = 'translateX(-5px)', 50);
                setTimeout(() => cell.style.transform = 'none', 100);
            }
        }

        // --- Rendering ---

        function renderInventory() {
            function createSlotHTML(player, size, index, isAvailable) {
                const isSelected = selectedPiece && selectedPiece.player === player && selectedPiece.index === index;
                
                // --- DYNAMIC SIZING FOR INVENTORY DISPLAY ---
                // These classes control how big the SVG looks INSIDE the sidebar slot
                let iconSizeClass = '';
                let strokeWidth = '';
                if (size === SIZES.SMALL) {
                    iconSizeClass = 'w-[40%] h-[40%]'; // Visibly Small
                    strokeWidth = 'stroke-width="5"';
                } else if (size === SIZES.MEDIUM) {
                    iconSizeClass = 'w-[70%] h-[70%]'; // Visibly Medium
                    strokeWidth = 'stroke-width="4"';
                } else {
                    iconSizeClass = 'w-[95%] h-[95%]'; // Fills the box
                    strokeWidth = 'stroke-width="3"';
                }

                // We inject the stroke width into the SVG generation here for the sidebar
                let icon;
                if (player === PLAYERS.X) {
                   icon = `<svg class="${iconSizeClass} piece-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" ${strokeWidth} stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`;
                } else {
                   icon = `<svg class="${iconSizeClass} piece-o" viewBox="0 0 24 24" fill="none" stroke="currentColor" ${strokeWidth} stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg>`;
                }
                
                return `
                    <div 
                        onclick="handleInventoryClick('${player}', ${size}, ${index})"
                        class="inventory-slot ${isSelected ? 'selected' : ''} ${!isAvailable ? 'disabled' : ''}"
                        title="Size: ${size}"
                    >
                        ${icon}
                    </div>
                `;
            }

            // Render X
            const xHTML = inventory.X.map((size, idx) => createSlotHTML('X', size, idx, currentPlayer === 'X')).join('');
            inventoryXEl.innerHTML = `
                <h3 class="hidden md:block text-cyan-400 font-bold mb-2">Player X</h3>
                <div class="grid grid-cols-3 gap-2 w-full max-w-[200px] mx-auto">${xHTML}</div>
            `;

            // Render O
            const oHTML = inventory.O.map((size, idx) => createSlotHTML('O', size, idx, currentPlayer === 'O')).join('');
            inventoryOEl.innerHTML = `
                <h3 class="hidden md:block text-rose-400 font-bold mb-2">Player O</h3>
                <div class="grid grid-cols-3 gap-2 w-full max-w-[200px] mx-auto">${oHTML}</div>
            `;
        }

        function renderBoard() {
            cells.forEach((cell, idx) => {
                const topPiece = getTopPiece(idx);
                cell.innerHTML = ''; // Clear current
                if (topPiece) {
                    const sizeClass = topPiece.size === 1 ? 'size-1' : topPiece.size === 2 ? 'size-2' : 'size-3';
                    const icon = topPiece.player === 'X' ? SVG_X(sizeClass) : SVG_O(sizeClass);
                    cell.innerHTML = icon;
                }
            });
        }

        // Listeners
        cells.forEach((cell, index) => {
            cell.addEventListener('click', () => handleCellClick(index));
        });

        resetBtn.addEventListener('click', () => {
            gameActive = true;
            currentPlayer = PLAYERS.X;
            boardState = Array(9).fill(null).map(() => []);
            inventory = {
                [PLAYERS.X]: [SIZES.SMALL, SIZES.SMALL, SIZES.SMALL, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.LARGE, SIZES.LARGE, SIZES.LARGE],
                [PLAYERS.O]: [SIZES.SMALL, SIZES.SMALL, SIZES.SMALL, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.MEDIUM, SIZES.LARGE, SIZES.LARGE, SIZES.LARGE]
            };
            selectedPiece = null;
            cells.forEach(c => {
                c.classList.remove('winning-cell', 'valid-target');
                c.innerHTML = '';
            });
            renderInventory();
            updateStatus();
            renderBoard();
        });

    </script>
</body>
</html>
